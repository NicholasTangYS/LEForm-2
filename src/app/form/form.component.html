<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
<div [hidden]="isLoading" class="page-layout-container">

    <!-- <button class="sidebar-toggle" (click)="toggleSidebar()">☰</button> -->
    <!-- Find the <nav class="sidebar"> section -->
    <nav class="sidebar" [class.sidebar-opened]="sidebarOpen">
        <div>
            <h2>LE1 Form Sections</h2>
            <ul>
                <li>
                    <a [routerLink]="['/form']" fragment="part-a"
                        [ngClass]="{'incomplete': !sectionStatus['part-a'], 'complete': sectionStatus['part-a']}">
                        Part A: Basic Particulars
                    </a>
                </li>
                <li>
                    <a [routerLink]="['/form']" fragment="part-b"
                        [ngClass]="{'incomplete': !sectionStatus['part-b'], 'complete': sectionStatus['part-b']}">
                        Part B: Tax Computation
                    </a>
                </li>
                <li>
                    <a [routerLink]="['/form']" fragment="part-c"
                        [ngClass]="{'incomplete': !sectionStatus['part-c'], 'complete': sectionStatus['part-c']}">
                        Part C: Entity Details
                    </a>
                </li>
                <li>
                    <a [routerLink]="['/form']" fragment="part-d"
                        [ngClass]="{'incomplete': !sectionStatus['part-d'], 'complete': sectionStatus['part-d']}">
                        Part D: CbC Reporting
                    </a>
                </li>
                <!-- part e & f -->
                <li>
                    <a [routerLink]="['/form']" fragment="part-e" *ngIf="le1Form.get('D1_Subject_as')?.value === '1' "
                        [ngClass]="{'incomplete': !sectionStatus['part-e'], 'complete': sectionStatus['part-e']}">
                        Part E: CbC Reporting Entity Details
                    </a>
                </li>
                <li>
                    <a [routerLink]="['/form']" fragment="part-f" *ngIf="le1Form.get('D1_Subject_as')?.value === '2' "
                        [ngClass]="{'incomplete': !sectionStatus['part-f'], 'complete': sectionStatus['part-f']}">
                        Part F: CbC Non Reporting Entity Details
                    </a>
                <li>
                    <a [routerLink]="['/form']" fragment="auditor"
                        [ngClass]="{'incomplete': !sectionStatus['auditor'], 'complete': sectionStatus['auditor']}">
                        Particular of Auditor
                    </a>
                </li>
                <li>
                    <a [routerLink]="['/form']" fragment="declaration"
                        [ngClass]="{'incomplete': !sectionStatus['declaration'], 'complete': sectionStatus['declaration']}">
                        Declaration
                    </a>
                </li>
                <li>
                    <a [routerLink]="['/form']" fragment="attachment-c3"
                        [ngClass]="{'incomplete': !sectionStatus['attachment-c3'], 'complete': sectionStatus['attachment-c3']}">
                        Att. C3: Compliance Officers
                    </a>
                </li>
                <li>
                    <a [routerLink]="['/form']" fragment="attachment-c4"
                        [ngClass]="{'incomplete': !sectionStatus['attachment-c4'], 'complete': sectionStatus['attachment-c4']}">
                        Att. C4: Major Shareholders
                    </a>
                </li>
                <li>
                    <a [routerLink]="['/form']" fragment="attachment-c5"
                        [ngClass]="{'incomplete': !sectionStatus['attachment-c5'], 'complete': sectionStatus['attachment-c5']}">
                        Att. C5: Beneficial Owners
                    </a>
                </li>
                <li>
                    <a [routerLink]="['/form']" fragment="attachment-c9"
                        [ngClass]="{'incomplete': !sectionStatus['attachment-c9'], 'complete': sectionStatus['attachment-c9']}">
                        Att. C9: Financial Particulars
                    </a>
                </li>
                <!-- Conditional Links -->
                <li>
                    <a [routerLink]="['/form']" fragment="attachment-c10"
                        *ngIf="le1Form.get('C10_Has_Subsidiary_Outside_Labuan')?.value === '1'"
                        [ngClass]="{'incomplete': !sectionStatus['attachment-c10'], 'complete': sectionStatus['attachment-c10']}">
                        Att. C10: Subsidiaries
                    </a>
                </li>
                <li>
                    <a [routerLink]="['/form']" fragment="attachment-c11"
                        *ngIf="le1Form.get('C11_Received_Payments_from_Malaysian_Resident')?.value === '1'"
                        [ngClass]="{'incomplete': !sectionStatus['attachment-c11'], 'complete': sectionStatus['attachment-c11']}">
                        Att. C11: Payments Received
                    </a>
                </li>
            </ul>
        </div>
        <div class="sidebar-footer">
            <span class="legend-item"><span class="dot complete"></span> Complete</span>
            <span class="legend-item"><span class="dot incomplete"></span> Incomplete</span>
        </div>
    </nav>
    <div class="content">
        <div style="display: flex; justify-content: space-between;">
            <div style="display: flex;  align-items: center;">
                <button (click)="back($event)" class="backbtn">← Back</button>
                <h2>Borang LE1 - Data Entry</h2>
            </div>

            <!-- <div style="display: flex; gap: 10px; max-width: 73vw; align-items: center;">
                <button (click)="saveProject()" [disabled]="isLoading">Save</button>
               
                <button type="submit" (click)="submit()">Submit</button>

            </div> -->

        </div>

        <!-- <p>Fill in the details and click "Generate PDF" to download the completed form.</p> -->
        <div style="overflow: auto; max-height: 94vh; max-width: 73vw;display: grid;">
            <form id="le1-form" [formGroup]="le1Form" (ngSubmit)="generatePdf()">

                <!-- Part A: Basic Particulars -->

                <fieldset id="part-a">
                    <legend>Part A: Basic Particulars</legend>
                    <label for="Year_of_Assessment_1">Year of Assessment:</label>
                    <input style="width: 20%;" type="number" id="Year_of_Assessment" min="0"
                        formControlName="Year_of_Assessment" maxlength="4" size="1">
                    <!-- <input style="width: 4%;" type="text" id="Year_of_Assessment_2"
                        formControlName="Year_of_Assessment_2" maxlength="1" size="1">
                    <input style="width: 4%;" type="text" id="Year_of_Assessment_3"
                        formControlName="Year_of_Assessment_3" maxlength="1" size="1">
                    <input style="width: 4%;" type="text" id="Year_of_Assessment_4"
                        formControlName="Year_of_Assessment_4" maxlength="1" size="1"> -->

                    <label for="Company_Name">Company Name:<span class="required-asterisk">*</span></label>
                    <input type="text" id="Company_Name" formControlName="Company_Name">

                    <!-- <label for="Company_Address_Line1">Address Line 1:</label>
                    <input type="text" id="Company_Address_Line1" formControlName="Company_Address_Line1">

                    <label for="Company_Address_Line2">Address Line 2:</label>
                    <input type="text" id="Company_Address_Line2" formControlName="Company_Address_Line2">
                    <div style="display: flex;justify-content: space-between;">
                        <div style="width: 25%;">
                            <label for="Postcode">Postcode:</label>
                            <input type="text" id="Postcode" formControlName="Postcode">
                        </div>

                        <div style="width: 25%;">
                            <label for="City">City:</label>
                            <input type="text" id="City" formControlName="City">
                        </div>

                        <div style="width: 25%;">
                            <label for="State">State:</label>
                            <input type="text" id="State" formControlName="State">
                        </div>

                    </div>


                    <label for="Company_Registration_No">Registration No:</label>
                    <input type="text" id="Company_Registration_No" formControlName="Company_Registration_No">

                    <label for="Company_TIN_LE">Company TIN:</label>
                    <input type="text" id="Company_TIN_LE" formControlName="Company_TIN_LE">

                    <label for="TIN_C_or_PT">TIN C/PT (if any):</label>
                    <input type="text" id="TIN_C_or_PT" formControlName="TIN_C_or_PT">

                    <label for="Employer_TIN">Employer TIN:</label>
                    <input type="text" id="Employer_TIN" formControlName="Employer_TIN">

                    <label for="Incorp_date_day">Incorporation Date (DD/MM/YYYY):</label>
                    <div style="display: flex; gap: 5px; align-items: center;border-radius: 5px;
        border: 1px solid #ccc; padding:5px; margin-bottom: 10px;">
                        <input style="width:4rem" type="number" id="Incorp_date_day" formControlName="Incorp_date_day"
                            size="2"> /
                        <input style="width:4rem" type="number" id="Incorp_date_month"
                            formControlName="Incorp_date_month" size="2"> /
                        <input style="width:5rem" type="number" id="Incorp_date_year" formControlName="Incorp_date_year"
                            size="4">
                    </div>

                    <label for="Telephone_no">Telephone No:</label>
                    <input type="text" id="Telephone_no" formControlName="Telephone_no">
                -->
                    <label for="Email">Email:</label>
                    <div style="margin-bottom: 10px;">
                        <input type="email" id="Email" formControlName="Email">
                    </div>
                    <label for="Telephone_no">Telephone No:</label>
                    <input type="number" min="0" id="Telephone_no" formControlName="Telephone_no">
                    <label for="Company_Registration_No">Registration No:</label>
                    <input type="text" id="Company_Registration_No" formControlName="Company_Registration_No">
                    <!-- Replace lines around Change_of_Accounting_Period_No -->
                    <label for="Change_of_Accounting_Period_No">Change of Accounting Period:</label>
                    <div class="btn-group mb-3" role="group">
                        <input type="radio" class="btn-check" name="Change_of_Accounting_Period_No"
                            id="Change_of_Accounting_Period_No_Yes" value="1"
                            formControlName="Change_of_Accounting_Period_No">
                        <label class="btn btn-outline-primary" for="Change_of_Accounting_Period_No_Yes">Yes</label>

                        <input type="radio" class="btn-check" name="Change_of_Accounting_Period_No"
                            id="Change_of_Accounting_Period_No_No" value="2"
                            formControlName="Change_of_Accounting_Period_No">
                        <label class="btn btn-outline-primary" for="Change_of_Accounting_Period_No_No">No</label>
                    </div>

                    <label for="Types_of_exchange_of_accounting_periods">Types of exchange of accounting
                        periods:</label>
                    <div class="btn-group mb-3" role="group">
                        <input type="radio" class="btn-check" id="Types_of_exchange_of_accounting_periods_1"
                            formControlName="Types_of_exchange_of_accounting_periods" value="1"
                            name="Types_of_exchange_of_accounting_periods">
                        <label class="btn btn-outline-primary" for="Types_of_exchange_of_accounting_periods_1">Shortened
                            period</label>

                        <input type="radio" class="btn-check" id="Types_of_exchange_of_accounting_periods_2"
                            formControlName="Types_of_exchange_of_accounting_periods" value="2"
                            name="Types_of_exchange_of_accounting_periods">
                        <label class="btn btn-outline-primary" for="Types_of_exchange_of_accounting_periods_2">Extended
                            period</label>
                    </div>

                    <label>Accounting Period:</label>
                    <div style="display: flex; gap: 5px; align-items: center;border-radius: 5px;
    border: 1px solid #ccc; padding:5px; justify-content: space-between;
    margin-bottom: 10px;">
                        <label for="Accounting_Period_From">From (DD/MM/YYYY):</label>
                        <input type="date" id="Accounting_Period_From" formControlName="Accounting_Period_From"
                            size="10">
                        <!-- <input style="width:4rem" type="number" id="Accounting_Period_From_Day"
                            formControlName="Accounting_Period_From_Day" size="2"> /
                        <input style="width:4rem" type="number" id="Accounting_Period_From_Month"
                            formControlName="Accounting_Period_From_Month" size="2"> /
                        <input style="width:5rem" type="number" id="Accounting_Period_From_Year"
                            formControlName="Accounting_Period_From_Year" size="4"> -->
                        <!-- split border Line -->
                        <span></span>
                        <label for="Accounting_Period_To_Day">To (DD/MM/YYYY):</label>
                        <input type="date" id="Accounting_Period_To" formControlName="Accounting_Period_To" size="10">
                        <!-- <input style="width:4rem" type="number" id="Accounting_Period_To_Day"
                            formControlName="Accounting_Period_To_Day" size="2"> /
                        <input style="width:4rem" type="number" id="Accounting_Period_To_Month"
                            formControlName="Accounting_Period_To_Month" size="2"> /
                        <input style="width:5rem" type="number" id="Accounting_Period_To_Year"
                            formControlName="Accounting_Period_To_Year" size="4"> -->
                    </div>

                    <label>Basis Period:</label>
                    <div style="display: flex; gap: 5px; align-items: center;border-radius: 5px;
    border: 1px solid #ccc; padding:5px;justify-content: space-between;
    margin-bottom: 10px;">
                        <label for="Basis_Period_From">From (DD/MM/YYYY):</label>
                        <input type="date" id="Basis_Period_From" formControlName="Basis_Period_From" size="10">
                        <!-- <input style="width:4rem" type="number" id="Basis_Period_From_Day"
                            formControlName="Basis_Period_From_Day" size="2">
                        /
                        <input style="width:4rem" type="number" id="Basis_Period_From_Month"
                            formControlName="Basis_Period_From_Month" size="2"> /
                        <input style="width:5rem" type="number" id="Basis_Period_From_Year"
                            formControlName="Basis_Period_From_Year" size="4"> -->
                        <label for="Basis_Period_To">To (DD/MM/YYYY):</label>
                        <input type="date" id="Basis_Period_To" formControlName="Basis_Period_To" size="10">
                        <!-- <input style="width:4rem" type="number" id="Basis_Period_To_Day"
                            formControlName="Basis_Period_To_Day" size="2">
                        /
                        <input style="width:4rem" type="number" id="Basis_Period_To_Month"
                            formControlName="Basis_Period_To_Month" size="2">
                        /
                        <input style="width:5rem" type="number" id="Basis_Period_To_Year"
                            formControlName="Basis_Period_To_Year" size="4"> -->
                    </div>

                    <label for="FS_in_Foreign_Currency_Yes">FS in Foreign Currency:</label>
                    <div class="btn-group mb-3" role="group">
                        <input type="radio" class="btn-check" id="FS_in_Foreign_Currency_Yes"
                            formControlName="FS_in_Foreign_Currency_Yes" value="1" name="FS_in_Foreign_Currency">
                        <label class="btn btn-outline-primary" for="FS_in_Foreign_Currency_Yes">Yes</label>

                        <input type="radio" class="btn-check" id="FS_in_Foreign_Currency_No"
                            formControlName="FS_in_Foreign_Currency_Yes" value="2" name="FS_in_Foreign_Currency">
                        <label class="btn btn-outline-primary" for="FS_in_Foreign_Currency_No">No</label>
                    </div>

                    <label for="Currency_Reported">Currency Reported:</label>
                    <input type="text" id="Currency_Reported" formControlName="Currency_Reported">

                    <label for="Currency_Exchange_Rate">Currency Exchange Rate:</label>
                    <input type="number" min="0" id="Currency_Exchange_Rate" formControlName="Currency_Exchange_Rate">

                    <label for="Record_keeping">Record keeping:</label>
                    <div class="btn-group mb-3" role="group">
                        <input type="radio" class="btn-check" id="Record_keeping_Yes" formControlName="Record_keeping"
                            value="1" name="Record_keeping">
                        <label class="btn btn-outline-primary" for="Record_keeping_Yes">Yes</label>

                        <input type="radio" class="btn-check" id="Record_keeping_No" formControlName="Record_keeping"
                            value="2" name="Record_keeping">
                        <label class="btn btn-outline-primary" for="Record_keeping_No">No</label>
                    </div>

                    <label for="Business_Status_In_Operation">Business Status:</label>
                    <div class="btn-group mb-3" role="group">
                        <input type="radio" class="btn-check" id="Business_Status_In_Operation"
                            formControlName="Business_Status_In_Operation" value="1" name="Business_Status">
                        <label class="btn btn-outline-primary" for="Business_Status_In_Operation">In Operation</label>

                        <input type="radio" class="btn-check" id="Business_Status_Dormant"
                            formControlName="Business_Status_In_Operation" value="2" name="Business_Status">
                        <label class="btn btn-outline-primary" for="Business_Status_Dormant">Dormant</label>

                        <input type="radio" class="btn-check" id="Business_Status_Winding"
                            formControlName="Business_Status_In_Operation" value="3" name="Business_Status">
                        <label class="btn btn-outline-primary" for="Business_Status_Winding">Winding-up</label>
                    </div>

                    <label for="Type_of_Labuan_entity">Type of Labuan entity:</label>
                    <div style="display: flex;
    flex-wrap: wrap;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-bottom: 10px;
    padding: 5px;">

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_1"
                                formControlName="Type_of_Labuan_entity" value="1" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_1">Labuan Company</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_2"
                                formControlName="Type_of_Labuan_entity" value="2" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_2">Labuan Foundation</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_3"
                                formControlName="Type_of_Labuan_entity" value="3" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_3">Labuan Islamic
                                Foundation</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_4"
                                formControlName="Type_of_Labuan_entity" value="4" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_4">Labuan Islamic
                                partnership</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_5"
                                formControlName="Type_of_Labuan_entity" value="5" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_5">Labuan limited
                                partnership</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_6"
                                formControlName="Type_of_Labuan_entity" value="6" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_6">Labuan Limited Liability
                                Partnership</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_7"
                                formControlName="Type_of_Labuan_entity" value="7" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_7">Labuan Islamic trust</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_8"
                                formControlName="Type_of_Labuan_entity" value="8" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_8">Labuan trust</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_9"
                                formControlName="Type_of_Labuan_entity" value="9" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_9">Malaysian Islamic bank
                                licensee</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_10"
                                formControlName="Type_of_Labuan_entity" value="10" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_10">Malaysian bank
                                licensee</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_11"
                                formControlName="Type_of_Labuan_entity" value="11" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_11">Any Labuan financial
                                institutions</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Type_of_Labuan_entity_12"
                                formControlName="Type_of_Labuan_entity" value="12" name="Type_of_Labuan_entity">
                            <label class="form-check-label" for="Type_of_Labuan_entity_12">Any person declared by the
                                Minister to be a Labuan
                                entity</label>
                        </div>

                    </div>

                    <label for="Incorp_under">Incorp under:</label>
                    <div style="display: flex;
    flex-wrap: wrap;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-bottom: 10px;
    padding: 5px;">

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Incorp_under_1"
                                formControlName="Incorp_under" value="1" name="Incorp_under">
                            <label class="form-check-label" for="Incorp_under_1">Labuan Companies
                                Act 1990</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Incorp_under_2"
                                formControlName="Incorp_under" value="2" name="Incorp_under">
                            <label class="form-check-label" for="Incorp_under_2">Labuan Foundations
                                Act 2010</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Incorp_under_3"
                                formControlName="Incorp_under" value="3" name="Incorp_under">
                            <label class="form-check-label" for="Incorp_under_3">Labuan Trusts Act 1996</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Incorp_under_4"
                                formControlName="Incorp_under" value="4" name="Incorp_under">
                            <label class="form-check-label" for="Incorp_under_4">Labuan Limited Partnerships and Limited
                                Liability Partnerships
                                Act
                                2010</label>
                        </div>
                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Incorp_under_5"
                                formControlName="Incorp_under" value="5" name="Incorp_under">
                            <label class="form-check-label" for="Incorp_under_5">Labuan Financial Services and
                                Securities Act 2010</label>
                        </div>
                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Incorp_under_6"
                                formControlName="Incorp_under" value="6" name="Incorp_under">
                            <label class="form-check-label" for="Incorp_under_6">Labuan Islamic Financial Services and
                                Securities Act
                                2010</label>
                        </div>



                    </div>
                </fieldset>

                <!-- Part B: Tax Computation -->
                <fieldset id="part-b">
                    <legend>Part B: Tax Computation</legend>
                    <h4>B1: Particulars of Labuan Business Activity</h4>

                    <!-- New FormArray Syntax -->
                    <div class="accordion-container" formArrayName="b1Rows">
                        <div *ngFor="let row of b1Rows.controls; let i = index" [formGroupName]="i"
                            class="accordion-item" [class.open]="accordionStates['b1'][i]">

                            <!-- Accordion Header -->
                            <div class="accordion-header"
                                (click)="accordionStates['b1'][i] = !accordionStates['b1'][i]">
                                <h5 class="accordion-title">
                                    Business Activity {{ i + 1 }}: {{ row.get('Business_Activity_Code')?.value ||
                                    'Select Activity' }}
                                </h5>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button type="button" class="btn btn-sm btn-outline-danger"
                                        (click)="$event.stopPropagation(); removeRow('b1', i)">
                                        Remove
                                    </button>
                                    <span class="accordion-icon">{{ accordionStates['b1'][i] ? '−' : '+' }}</span>
                                </div>
                            </div>

                            <!-- Accordion Body -->
                            <div *ngIf="accordionStates['b1'][i]" class="accordion-body">
                                <div class="details-grid">
                                    <!-- Col 1 -->
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label [for]="'b1_code_'+i">Activity Code</label>
                                            <select [id]="'b1_code_'+i" class="form-select"
                                                formControlName="Business_Activity_Code">
                                                <option value="" disabled>-- Select --</option>
                                                <option *ngFor="let activity of businessActivities"
                                                    [value]="activity.code">
                                                    {{ activity.code }} {{activity.mark}}
                                                </option>
                                            </select>
                                        </div>
                                        <div class="field-group">
                                            <label>Core Income</label>
                                            <select class="form-select" formControlName="Core_Income_Activity_Yes">
                                                <option value="1">Yes</option>
                                                <option value="2">No</option>
                                            </select>
                                        </div>
                                        <div class="field-group">
                                            <label>Status</label>
                                            <select class="form-select"
                                                formControlName="Business_Activity_Status_Active">
                                                <option value="1">Active</option>
                                                <option value="2">Dormant</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Col 2 -->
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>No. of Employees (Labuan)</label>
                                            <input type="number" formControlName="No_of_Employees">
                                        </div>
                                        <div class="field-group">
                                            <label>OpEx in Labuan (RM)</label>
                                            <input type="number" formControlName="Annual_Operating_Expenditure">
                                        </div>
                                        <div class="field-group">
                                            <label>OpEx in Malaysia (RM)</label>
                                            <input type="text" formControlName="Annual_Operating_Expenditure_MAS">
                                        </div>
                                        <div class="field-group">
                                            <label>Compliance with FPEC</label>
                                            <select class="form-select" formControlName="Compliance_with_FPEC">
                                                <option value="1">Yes</option>
                                                <option value="2">No</option>
                                            </select>
                                        </div>
                                        <div class="field-group">
                                            <label>Compliance with CML</label>
                                            <select class="form-select" formControlName="Compliance_with_CML">
                                                <option value="1">Yes</option>
                                                <option value="2">No</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Col 3 -->
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>No. of Employees (Malaysia)</label>
                                            <input type="number" formControlName="No_of_Employees_Malaysia">
                                        </div>
                                        <div class="field-group">
                                            <label>No. of Related Companies</label>
                                            <input type="number" formControlName="No_of_Related_Company">
                                        </div>
                                        <div class="field-group">
                                            <label>Net Loss (RM)</label>
                                            <textarea appThousandSeparator type="number"
                                                formControlName="Amount_of_Net_Loss"></textarea>
                                        </div>
                                        <div class="field-group">
                                            <label>Net Profit (RM)</label>
                                            <textarea appThousandSeparator type="number"
                                                formControlName="Net_Profits_ex_IP"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <button type="button" class="btn btn-outline-primary" (click)="addRow('b1')">+ Add Business
                            Activity</button>
                    </div>

                    <div style="margin: 10px;"></div>
                    <h3>B2: Total Net Profits (RM):</h3>
                    <textarea readonly type="number" appThousandSeparator id="B2_Total_Net_Profits"
                        formControlName="B2_Total_Net_Profits"></textarea>
                </fieldset>

                <!-- Part C, D, etc. -->
                <fieldset id="part-c">
                    <legend>Part C: Particulars of Labuan Entity</legend>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label for="C1_Registered_Address_line1">Registered Address Line 1:</label>
                            <input type="text" id="C1_Registered_Address_line1"
                                formControlName="C1_Registered_Address_line1">

                            <label for="C1_Registered_Address_line2">Registered Address Line 2:</label>
                            <input type="text" id="C1_Registered_Address_line2"
                                formControlName="C1_Registered_Address_line2">
                        </div>

                    </div>

                    <div style="display: flex; justify-content: space-between; gap: 10px;">
                        <div style="flex: 1;">
                            <label for="C1_Postcode">Registered Postcode:</label>
                            <input type="text" disabled value="87000">
                        </div>
                        <div style="flex: 1;">
                            <label for="C1_City">Registered City:</label>
                            <input type="text" disabled value="Labuan">
                        </div>
                        <div style="flex: 1;">
                            <label for="C1_State">Registered State:</label>
                            <input type="text" disabled value="Wilayah Persekutuan Labuan">
                        </div>
                        <!-- <div style="flex: 1;">
                            <label for="C1_Country">Correspondence Country:</label>
                            <input type="text" id="C1_Country" formControlName="C1_Country">
                        </div> -->
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label for="C1_Correspondence_Address_line1">Correspondence Address Line 1:</label>
                            <input type="text" id="C1_Correspondence_Address_line1"
                                formControlName="C1_Correspondence_Address_line1">

                            <label for="C1_Correspondence_Address_line2">Correspondence Address Line 2:</label>
                            <input type="text" id="C1_Correspondence_Address_line2"
                                formControlName="C1_Correspondence_Address_line2">
                        </div>

                    </div>

                    <div style="display: flex; justify-content: space-between; gap: 10px;">
                        <div style="flex: 1;">
                            <label for="C1_Postcode">Correspondence Postcode:</label>
                            <input type="text" id="C1_Postcode" formControlName="C1_Postcode">
                        </div>
                        <div style="flex: 1;">
                            <label for="C1_City">Correspondence City:</label>
                            <input type="text" id="C1_City" formControlName="C1_City">
                        </div>
                        <div style="flex: 1;">
                            <label for="C1_State">Correspondence State:</label>
                            <input type="text" id="C1_State" formControlName="C1_State">
                        </div>
                        <!-- <div style="flex: 1;">
                            <label for="C1_Country">Correspondence Country:</label>
                            <input type="text" id="C1_Country" formControlName="C1_Country">
                        </div> -->
                    </div>
                    <div>
                        <label for="C2_Address_Is_Tax_Agent_or_Trust_Co">Address is Tax Agent or Trust Co:</label>
                        <!-- <input type="text" id="C2_Address_Is_Tax_Agent_or_Trust_Co"
                            formControlName="C2_Address_Is_Tax_Agent_or_Trust_Co"> -->
                        <select formControlName="C2_Address_Is_Tax_Agent_or_Trust_Co" class="form-select">
                            <option value="" disabled>-- Select --</option>
                            <option value="1">
                                Tax Agent
                            </option>
                            <option value="2">
                                Trust Co
                            </option>
                            <option value="3">
                                No
                            </option>
                        </select>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                            <div>
                                <label>Has Related Company:</label>
                                <div class="btn-group" role="group">
                                    <input type="radio" class="btn-check" name="C6a_Has_Related_Company" id="C6a_Yes"
                                        value="1" formControlName="C6a_Has_Related_Company">
                                    <label class="btn btn-outline-primary" for="C6a_Yes">Yes</label>

                                    <input type="radio" class="btn-check" name="C6a_Has_Related_Company" id="C6a_No"
                                        value="2" formControlName="C6a_Has_Related_Company">
                                    <label class="btn btn-outline-secondary" for="C6a_No">No</label>
                                </div>
                            </div>
                            <div>
                                <label for="C6b_Number_of_Related_Companies_Qualifying_Activity">Number of Related
                                    Companies
                                    Qualifying Activity:</label>
                                <input type="number" id="C6b_Number_of_Related_Companies_Qualifying_Activity" min="0"
                                    formControlName="C6b_Number_of_Related_Companies_Qualifying_Activity">
                            </div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                        <div>
                            <label for="C7a_Derived_Income_from_Non_Labuan_Activity">Derived Income from Non-Labuan
                                Activity:</label>
                            <div class="btn-group mb-3" role="group">
                                <input type="radio" class="btn-check" id="C7a_Yes" value="1"
                                    formControlName="C7a_Derived_Income_from_Non_Labuan_Activity"
                                    name="C7a_Derived_Income_from_Non_Labuan_Activity">
                                <label class="btn btn-outline-primary" for="C7a_Yes">Yes</label>

                                <input type="radio" class="btn-check" id="C7a_No" value="2"
                                    formControlName="C7a_Derived_Income_from_Non_Labuan_Activity"
                                    name="C7a_Derived_Income_from_Non_Labuan_Activity">
                                <label class="btn btn-outline-primary" for="C7a_No">No</label>
                            </div>
                        </div>
                        <div>
                            <label for="C7b_Total_Income_from_Non_Labuan_Activity">Total Income from Non-Labuan
                                Activity:</label>
                            <input type="number" id="C7b_Total_Income_from_Non_Labuan_Activity" min="0"
                                formControlName="C7b_Total_Income_from_Non_Labuan_Activity">
                        </div>
                        <div>
                            <label for="C8a_Derived_Income_from_IP">Derived Income from IP:</label>
                            <div class="btn-group mb-3" role="group">
                                <input type="radio" class="btn-check" id="C8a_Yes" value="1"
                                    formControlName="C8a_Derived_Income_from_IP" name="C8a_Derived_Income_from_IP">
                                <label class="btn btn-outline-primary" for="C8a_Yes">Yes</label>

                                <input type="radio" class="btn-check" id="C8a_No" value="2"
                                    formControlName="C8a_Derived_Income_from_IP" name="C8a_Derived_Income_from_IP">
                                <label class="btn btn-outline-primary" for="C8a_No">No</label>
                            </div>
                        </div>
                        <div>
                            <label for="C8b_Total_Income_from_IP">Total Income from IP:</label>
                            <input type="number" min="0" id="C8b_Total_Income_from_IP"
                                formControlName="C8b_Total_Income_from_IP">
                        </div>
                        <div>
                            <label for="C10_Has_Subsidiary_Outside_Labuan">Has Subsidiary Outside Labuan:</label>
                            <div class="btn-group mb-3" role="group">
                                <input type="radio" class="btn-check" id="C10a_Yes" value="1"
                                    formControlName="C10_Has_Subsidiary_Outside_Labuan"
                                    name="C10_Has_Subsidiary_Outside_Labuan">
                                <label class="btn btn-outline-primary" for="C10a_Yes">Yes</label>

                                <input type="radio" class="btn-check" id="C10a_No" value="2"
                                    formControlName="C10_Has_Subsidiary_Outside_Labuan"
                                    name="C10_Has_Subsidiary_Outside_Labuan">
                                <label class="btn btn-outline-primary" for="C10a_No">No</label>
                            </div>
                        </div>
                        <div>
                            <label for="C11_Received_Payments_from_Malaysian_Resident">Received Payments from Malaysian
                                Resident:</label>
                            <div class="btn-group mb-3" role="group">
                                <input type="radio" class="btn-check" id="C11_Yes" value="1"
                                    formControlName="C11_Received_Payments_from_Malaysian_Resident"
                                    name="C11_Received_Payments_from_Malaysian_Resident">
                                <label class="btn btn-outline-primary" for="C11_Yes">Yes</label>

                                <input type="radio" class="btn-check" id="C11_No" value="2"
                                    formControlName="C11_Received_Payments_from_Malaysian_Resident"
                                    name="C11_Received_Payments_from_Malaysian_Resident">
                                <label class="btn btn-outline-primary" for="C11_No">No</label>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <h3>Incentive Details</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #f2f2f2;">
                                <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Incentive Code</th>
                                <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Amount Claimed</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;">
                                    <!-- <input type="text" id="C12_Row1_Incentive_Code"
                                        formControlName="C12_Row1_Incentive_Code" style="width: 100%;"> -->
                                    <select formControlName="C12_Row1_Incentive_Code" class="form-select">
                                        <option value="" disabled>-- Select --</option>
                                        <option *ngFor="let activity of incentiveCodes" [value]="activity.code">
                                            {{ activity.code }}
                                        </option>
                                    </select>
                                </td>
                                <td style="padding: 8px; border: 1px solid #ddd;">
                                    <textarea type="number" id="C12_Row1_Amount_Claimed" appThousandSeparator
                                        formControlName="C12_Row1_Amount_Claimed" style="width: 100%;"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;">
                                    <!-- <input type="text" id="C12_Row2_Incentive_Code"
                                        formControlName="C12_Row2_Incentive_Code" style="width: 100%;"> -->
                                    <select formControlName="C12_Row2_Incentive_Code" class="form-select">
                                        <option value="" disabled>-- Select --</option>
                                        <option *ngFor="let activity of incentiveCodes" [value]="activity.code">
                                            {{ activity.code }}
                                        </option>
                                    </select>
                                </td>
                                <td style="padding: 8px; border: 1px solid #ddd;">
                                    <textarea appThousandSeparator type="number" id="C12_Row2_Amount_Claimed"
                                        formControlName="C12_Row2_Amount_Claimed" style="width: 100%;"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ddd;">
                                    <!-- <input type="text" id="C12_Row3_Incentive_Code"
                                        formControlName="C12_Row3_Incentive_Code" style="width: 100%;"> -->
                                    <select formControlName="C12_Row3_Incentive_Code" class="form-select">
                                        <option value="" disabled>-- Select --</option>
                                        <option *ngFor="let activity of incentiveCodes" [value]="activity.code">
                                            {{ activity.code }}
                                        </option>
                                    </select>
                                </td>
                                <td style="padding: 8px; border: 1px solid #ddd;">
                                    <textarea type="number" id="C12_Row3_Amount_Claimed" appThousandSeparator
                                        formControlName="C12_Row3_Amount_Claimed" style="width: 100%;"></textarea>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </fieldset>

                <!-- Part D: CbC Reporting -->
                <fieldset id="part-d">
                    <legend>Part D: Particulars Of Country-By-Country Reporting</legend>
                    <label>Subject to CbCR?</label>
                    <div class="btn-group mb-3" role="group">
                        <input type="radio" class="btn-check" id="D1_CbCR_Yes" value="1"
                            formControlName="D1_Subject_to_CbCR" name="D1_Subject_to_CbCR">
                        <label class="btn btn-outline-primary" for="D1_CbCR_Yes">Yes</label>

                        <input type="radio" class="btn-check" id="D1_CbCR_No" value="2"
                            formControlName="D1_Subject_to_CbCR" name="D1_Subject_to_CbCR">
                        <label class="btn btn-outline-primary" for="D1_CbCR_No">No</label>
                    </div>
                    <label>Subject as a reporting entity / non-reporting entity</label>
                    <div class="btn-group mb-3" role="group">
                        <input type="radio" class="btn-check" id="D1_Subject_as_Yes" value="1"
                            formControlName="D1_Subject_as" name="D1_Subject_as">
                        <label class="btn btn-outline-primary" for="D1_Subject_as_Yes">Reporting entity</label>

                        <input type="radio" class="btn-check" id="D1_Subject_as_No" value="2"
                            formControlName="D1_Subject_as" name="D1_Subject_as">
                        <label class="btn btn-outline-primary" for="D1_Subject_as_No">Non-reporting entity</label>
                    </div>
                    <div style="display: flex; justify-content: space-between; gap: 10px;">
                        <div style="flex: 1;">
                            <label for="D3_Has_Financial_Account_Outside_Malaysia">Has financial account(s) at financial
                                institution(s)
                                outside Malaysia:</label>
                            <!-- <input type="text" id="D3_Has_Financial_Account_Outside_Malaysia"
                                formControlName="D3_Has_Financial_Account_Outside_Malaysia"> -->
                            <select formControlName="D3_Has_Financial_Account_Outside_Malaysia" class="form-select">
                                <option value="" disabled>-- Select --</option>
                                <option value="1">
                                    Yes
                                </option>
                                <option value="2">
                                    No
                                </option>

                            </select>
                        </div>
                        <div style="flex: 1;">
                            <label for="D4_Subject_to_AEOI">Subject to the Labuan Business Activity Tax (Automatic
                                Exchange
                                Of Financial
                                Account
                                Information) Regulations 2018:</label>
                            <select formControlName="D4_Subject_to_AEOI" class="form-select">
                                <option value="" disabled>-- Select --</option>
                                <option value="1">
                                    Yes
                                </option>
                                <option value="2">
                                    No
                                </option>

                            </select>
                            <!-- <input type="text" id="D4_Subject_to_AEOI" formControlName="D4_Subject_to_AEOI"> -->
                        </div>
                    </div>
                </fieldset>

                <!-- Part E: Reporting Entity -->
                <ng-container *ngIf="le1Form.get('D1_Subject_as')?.value === '1'">
                    <fieldset id="part-e">
                        <legend>Part E: Reporting Entity</legend>
                        <label for="E1_MNE_Group_Name">MNE Group Name:</label>
                        <input type="text" id="E1_MNE_Group_Name" formControlName="E1_MNE_Group_Name">
                        <label>Accounting Period:</label>
                        <div style="display: flex; gap: 5px; align-items: center;border-radius: 5px;
    border: 1px solid #ccc; padding:5px; justify-content: space-between;
    margin-bottom: 10px;">
                            <label for="E2_Accounting_Period_From">From (DD/MM/YYYY):</label>
                            <!-- <input style="width:4rem" type="number" id="E2_Accounting_Period_From_Day"
                                formControlName="E2_Accounting_Period_From_Day" size="2"> /
                            <input style="width:4rem" type="number" id="E2_Accounting_Period_From_Month"
                                formControlName="E2_Accounting_Period_From_Month" size="2"> /
                            <input style="width:5rem" type="number" id="E2_Accounting_Period_From_Year"
                                formControlName="E2_Accounting_Period_From_Year" size="4"> -->
                            <input type="date" id="E2_Accounting_Period_From"
                                formControlName="E2_Accounting_Period_From" size="4">
                            <!-- split border Line -->
                            <span></span>
                            <label for="E2_Accounting_Period_To">To (DD/MM/YYYY):</label>
                            <!-- <input style="width:4rem" type="number" id="E2_Accounting_Period_To_Day"
                                formControlName="E2_Accounting_Period_To_Day" size="2"> /
                            <input style="width:4rem" type="number" id="E2_Accounting_Period_To_Month"
                                formControlName="E2_Accounting_Period_To_Month" size="2"> /
                            <input style="width:5rem" type="number" id="E2_Accounting_Period_To_Year"
                                formControlName="E2_Accounting_Period_To_Year" size="4"> -->
                            <input type="date" id="E2_Accounting_Period_To" formControlName="E2_Accounting_Period_To"
                                size="4">
                        </div>
                        <div style="display: flex; justify-content: space-between; gap: 10px;">
                            <div style="flex: 1;">
                                <label for="E3_Constituent_Entities_in_Malaysia">Number of constituent entities in
                                    Malaysia:</label>
                                <input type="number" id="E3_Constituent_Entities_in_Malaysia" min="0"
                                    formControlName="E3_Constituent_Entities_in_Malaysia">
                            </div>
                            <div style="flex: 1;">
                                <label for="E4_Constituent_Entities_outside_Malaysia">Number of constituent entities
                                    outside
                                    Malaysia:</label>
                                <input type="number" min="0" id="E4_Constituent_Entities_outside_Malaysia"
                                    formControlName="E4_Constituent_Entities_outside_Malaysia">
                            </div>
                        </div>
                    </fieldset>
                </ng-container>
                <ng-container *ngIf="le1Form.get('D1_Subject_as')?.value === '2'">
                    <!-- Part F: Non-Reporting Entity -->
                    <fieldset id="part-f">
                        <legend>Part F: Non-Reporting Entity</legend>

                        <div style="display: flex; justify-content: space-between; gap: 10px; margin-bottom: 10px;">
                            <div style="flex: 2;">
                                <label for="F1_Reporting_Entity_Name">Reporting Entity Name:</label>
                                <input type="text" id="F1_Reporting_Entity_Name"
                                    formControlName="F1_Reporting_Entity_Name">
                            </div>
                            <div style="flex: 1;">
                                <label for="F2_TIN">TIN:</label>
                                <input type="text" id="F2_TIN" formControlName="F2_TIN">
                            </div>
                            <div style="flex: 1;">
                                <label for="F3_Country_of_Residence">Country of Residence(Entity):</label>
                                <!-- <input type="text" id="F3_Country_of_Residence"
                                    formControlName="F3_Country_of_Residence"> -->
                                <select formControlName="F3_Country_of_Residence" class="form-select"
                                    style="margin-bottom: 10px;">
                                    <option value="" disabled>-- Select a Country --</option>
                                    <option *ngFor="let country of countries" [value]="country.code">
                                        {{ country.name }}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <label>Accounting Period:</label>
                        <div style="display: flex; gap: 5px; align-items: center;border-radius: 5px;
border: 1px solid #ccc; padding:5px; justify-content: space-between;
margin-bottom: 10px;">
                            <label for="F4_Accounting_Period_From">From (DD/MM/YYYY):</label>
                            <!-- <input style="width:4rem" type="number" id="F4_Accounting_Period_From_Day"
                                formControlName="F4_Accounting_Period_From_Day" size="2"> /
                            <input style="width:4rem" type="number" id="F4_Accounting_Period_From_Month"
                                formControlName="F4_Accounting_Period_From_Month" size="2"> /
                            <input style="width:5rem" type="number" id="F4_Accounting_Period_From_Year"
                                formControlName="F4_Accounting_Period_From_Year" size="4"> -->
                            <input type="date" id="F4_Accounting_Period_From"
                                formControlName="F4_Accounting_Period_From">
                            <!-- split border Line -->
                            <span></span>
                            <label for="F4_Accounting_Period_To">To (DD/MM/YYYY):</label>
                            <!-- <input style="width:4rem" type="number" id="F4_Accounting_Period_To_Day"
                                formControlName="F4_Accounting_Period_To_Day" size="2"> /
                            <input style="width:4rem" type="number" id="F4_Accounting_Period_To_Month"
                                formControlName="F4_Accounting_Period_To_Month" size="2"> /
                            <input style="width:8rem" type="number" id="F4_Accounting_Period_To_Year"
                                formControlName="F4_Accounting_Period_To_Year" size="4"> -->
                            <input type="date" id="F4_Accounting_Period_To" formControlName="F4_Accounting_Period_To"
                                size="4">
                        </div>

                        <div style="display: flex; justify-content: space-between; gap: 10px;">
                            <div style="flex: 1;">
                                <label for="F5_MNE_Group_Name">MNE Group Name:</label>
                                <input type="text" id="F5_MNE_Group_Name" formControlName="F5_MNE_Group_Name">
                            </div>
                            <div style="flex: 1;">
                                <label for="F6_Status_of_Reporting_Entity">Status of Reporting Entity(1= Ultimate
                                    holding
                                    entity, 2=
                                    Surrogate holding entity):</label>
                                <!-- <input type="text" id="F6_Status_of_Reporting_Entity"
                                    formControlName="F6_Status_of_Reporting_Entity"> -->
                                <select formControlName="F6_Status_of_Reporting_Entity" class="form-select">
                                    <option value="" disabled>-- Select --</option>
                                    <option value="1">
                                        Ultimate
                                        holding
                                        entity
                                    </option>
                                    <option value="2">
                                        Surrogate holding entity
                                    </option>

                                </select>
                            </div>
                        </div>

                        <div style="display: flex; justify-content: space-between; gap: 10px; margin-top: 10px;">
                            <div style="flex: 1;">
                                <label for="F7a_Ultimate_Holding_Entity_Name">Ultimate Holding Entity Name:</label>
                                <input type="text" id="F7a_Ultimate_Holding_Entity_Name"
                                    formControlName="F7a_Ultimate_Holding_Entity_Name">
                            </div>
                            <div style="flex: 1;">
                                <label for="F7b_Country_of_Residence_UHE">Country of Residence(MNE Group):</label>
                                <!-- <input type="text" id="F7b_Country_of_Residence_UHE"
                                    formControlName="F7b_Country_of_Residence_UHE"> -->
                                <select formControlName="F7b_Country_of_Residence_UHE" class="form-select"
                                    style="margin-bottom: 10px;">
                                    <option value="" disabled>-- Select a Country --</option>
                                    <option *ngFor="let country of countries" [value]="country.code">
                                        {{ country.name }}
                                    </option>
                                </select>
                            </div>
                        </div>
                    </fieldset>
                </ng-container>
                <fieldset id="auditor">
                    <legend>Particular of Auditor</legend>
                    <label for="Auditor_Name">Auditor Firm Name:</label>
                    <input type="text" id="Auditor_Name" formControlName="Auditor_Name">
                    <select formControlName="Auditor_Country" class="form-select" style="margin-bottom: 10px;">
                        <option value="" disabled>-- Select a Country --</option>
                        <option *ngFor="let country of countries" [value]="country.code">
                            {{ country.name }}
                        </option>
                    </select>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <label for="C1_Correspondence_Address_line1">Auditor Firm Address Line 1:</label>
                            <input type="text" id="C1_Correspondence_Address_line1"
                                formControlName="C1_Correspondence_Address_line1">

                            <label for="C1_Correspondence_Address_line2">Auditor Firm Address Line 2:</label>
                            <input type="text" id="C1_Correspondence_Address_line2"
                                formControlName="C1_Correspondence_Address_line2">
                        </div>

                    </div>

                    <div style="display: flex; justify-content: space-between; gap: 10px;">
                        <div style="flex: 1;">
                            <label for="C1_Postcode">Auditor Firm Postcode:</label>
                            <input type="text" id="C1_Postcode" formControlName="C1_Postcode">
                        </div>
                        <div style="flex: 1;">
                            <label for="C1_City">Auditor Firm City:</label>
                            <input type="text" id="C1_City" formControlName="C1_City">
                        </div>

                        <!-- <div style="flex: 1;">
                            <label for="C1_Country">Correspondence Country:</label>
                            <input type="text" id="C1_Country" formControlName="C1_Country">
                        </div> -->
                    </div>
                    <div style="display: flex; justify-content: space-between; gap: 10px;">


                        <div style="flex:1;">
                            <label for="Auditor_Email">Auditor Email:</label>
                            <input type="text" id="Auditor_Email" formControlName="Auditor_Email">
                        </div>
                        <div style="flex:1;">
                            <label for="Auditor_Telephone_no">Auditor Phone Number:</label>
                            <input type="text" id="Auditor_Telephone_no" formControlName="Auditor_Telephone_no">
                        </div>
                        <div style="flex:1;">
                            <label for="Auditor_TIN">Auditor TIN:</label>
                            <input type="text" id="Auditor_TIN" formControlName="Auditor_TIN">
                        </div>
                    </div>
                </fieldset>

                <!-- Declaration -->
                <fieldset id="declaration">
                    <legend>Declaration</legend>
                    <label>Designation:</label>
                    <div class="btn-group" role="group">
                        <input type="radio" class="btn-check" name="Declarant_Designation" id="Declare_1" value="1"
                            formControlName="Declarant_Designation">
                        <label class="btn btn-outline-primary" for="Declare_1">Tax Agent</label>

                        <input type="radio" class="btn-check" name="Declarant_Designation" id="Declare_2" value="2"
                            formControlName="Declarant_Designation">
                        <label class="btn btn-outline-primary" for="Declare_2">Director</label>
                    </div>
                    <ng-container *ngIf="le1Form.get('Declarant_Designation')?.value === '1'">

                        <label for="Declarant_Address_line1">Address of firm:</label>
                        <input type="text" id="Declarant_Address_line1" formControlName="Declarant_Address_line1">
                        <input type="text" id="Declarant_Address_line2" formControlName="Declarant_Address_line2">

                        <label for="Declarant_Postcode">Postcode:</label>
                        <input style="width: 30%;" type="text" id="Declarant_Postcode"
                            formControlName="Declarant_Postcode">

                        <div style="display: flex; justify-content: space-between; gap: 10px;">


                            <!-- <div style="flex:1;">
                            <label for="Declarant_Postcode">Postcode:</label>
                            <input type="text" id="Declarant_Postcode" formControlName="Declarant_Postcode">
                        </div> -->
                            <div style="flex:1;">
                                <label for="Declarant_Telephone_no">Tax Agent Phone Number:</label>
                                <input type="text" id="Declarant_Telephone_no" formControlName="Declarant_Telephone_no">
                            </div>
                            <div style="flex:1;">
                                <label for="Declarant_Email">Tax Agent Email:</label>
                                <input type="text" id="Declarant_Email" formControlName="Declarant_Email">
                            </div>
                        </div>
                    </ng-container> 
                    <!-- <label for="Declaration_Date">Declaration Date (DD/MM/YYYY):</label>
                    <div style="display: flex; gap: 5px; align-items: center; padding:5px; 
margin-bottom: 10px;">
                        <input type="date" id="Declaration_Date" formControlName="Declaration_Date">
                        
                    </div> -->

                    <!-- <label for="Declarant_Designation">Designation:</label> -->
                    <!-- <div style="display: flex;
    flex-wrap: wrap;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-bottom: 10px;
    padding: 5px;">

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Declarant_Designation_1"
                                formControlName="Declarant_Designation" value="1" name="Declarant_Designation">
                            <label class="form-check-label" for="Declarant_Designation_1">Manager or principal officer
                                in Malaysia</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Declarant_Designation_2"
                                formControlName="Declarant_Designation" value="2" name="Declarant_Designation">
                            <label class="form-check-label" for="Declarant_Designation_2">Resident director as provided
                                in the Labuan Companies
                                Act
                                1990</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Declarant_Designation_3"
                                formControlName="Declarant_Designation" value="3" name="Declarant_Designation">
                            <label class="form-check-label" for="Declarant_Designation_3">Secretary</label>
                        </div>

                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Declarant_Designation_4"
                                formControlName="Declarant_Designation" value="4" name="Declarant_Designation">
                            <label class="form-check-label" for="Declarant_Designation_4">Trustee</label>
                        </div>
                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Declarant_Designation_5"
                                formControlName="Declarant_Designation" value="5" name="Declarant_Designation">
                            <label class="form-check-label" for="Declarant_Designation_5">Liquidator or receiver</label>
                        </div>
                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Declarant_Designation_6"
                                formControlName="Declarant_Designation" value="6" name="Declarant_Designation">
                            <label class="form-check-label" for="Declarant_Designation_6">Partner or general
                                partner</label>
                        </div>
                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Declarant_Designation_7"
                                formControlName="Declarant_Designation" value="7" name="Declarant_Designation">
                            <label class="form-check-label" for="Declarant_Designation_7">Designated partner</label>
                        </div>
                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Declarant_Designation_8"
                                formControlName="Declarant_Designation" value="8" name="Declarant_Designation">
                            <label class="form-check-label" for="Declarant_Designation_8">Tax Agent</label>
                        </div>
                        <div style="width: 33.33%;" class="form-check">
                            <input class="form-check-input" type="radio" id="Declarant_Designation_9"
                                formControlName="Declarant_Designation" value="9" name="Declarant_Designation">
                            <label class="form-check-label" for="Declarant_Designation_9">Others </label>
                        </div>



                    </div> -->

                </fieldset>

                <!-- Attachment C3: Compliance Officers -->
                <!-- in form.component.html -->
                <fieldset id="attachment-c3">
                    <legend>Attachment C3: Compliance Officers</legend>
                    <div class="accordion-container" formArrayName="c3Rows">
                        <div *ngFor="let row of c3Rows.controls; let i = index" [formGroupName]="i"
                            class="accordion-item" [class.open]="accordionStates['c3'][i]">
                            <div class="accordion-header"
                                (click)="accordionStates['c3'][i] = !accordionStates['c3'][i]">
                                <h5 class="accordion-title">
                                    Officer {{ i + 1 }}: {{ row.get('Name')?.value || 'New Officer' }}
                                </h5>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button type="button" class="btn btn-sm btn-outline-danger"
                                        (click)="$event.stopPropagation(); removeRow('c3', i)">
                                        Remove
                                    </button>
                                    <span class="accordion-icon">{{ accordionStates['c3'][i] ? '−' : '+' }}</span>
                                </div>
                            </div>
                            <div *ngIf="accordionStates['c3'][i]" class="accordion-body">
                                <div class="details-grid">
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>Name</label>
                                            <input type="text" class="form-control" formControlName="Name">
                                        </div>
                                        <div class="field-group">
                                            <label>Designation</label>
                                            <select class="form-select" formControlName="Designation">
                                                <option value="" disabled>--Please Select--</option>
                                                <option value="1">Manager or principal officer</option>
                                                <option value="2">Resident director</option>
                                                <option value="3">Secretary</option>
                                                <option value="9">Others</option>
                                            </select>
                                        </div>
                                        <div class="field-group">
                                            <label>Claim P.U.(A) 419/2011</label>
                                            <select class="form-select" formControlName="Claim_PUA_419_2011">
                                                <option value="" disabled>-- Select --</option>
                                                <option value="1">Yes</option>
                                                <option value="2">No</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>ID / Passport</label>
                                            <div class="input-group">
                                                <select formControlName="ID_type" class="form-select"
                                                    style="max-width: 100px;">
                                                    <option value="1">ID</option>
                                                    <option value="2">Passport</option>
                                                </select>
                                                <input type="text" class="form-control" formControlName="ID_Passport_No"
                                                    placeholder="Number">
                                            </div>
                                        </div>
                                        <div class="field-group">
                                            <label>Date of Birth</label>
                                            <input type="date" class="form-control" formControlName="Date_of_Birth">
                                        </div>
                                        <div class="field-group">
                                            <label>Address</label>
                                            <div class="d-flex flex-column gap-2">
                                                <select class="form-select" formControlName="Country">
                                                    <option value="" disabled>-- Country --</option>
                                                    <option *ngFor="let country of countries" [value]="country.code">{{
                                                        country.name }}</option>
                                                </select>
                                                <textarea class="form-control" appAutoResize placeholder="Line 1"
                                                    formControlName="Address1"></textarea>
                                                <textarea class="form-control" appAutoResize placeholder="Line 2"
                                                    formControlName="Address2"></textarea>
                                                <input type="text" class="form-control" placeholder="Postcode"
                                                    formControlName="Postcode">
                                                <input type="text" class="form-control" placeholder="Town"
                                                    formControlName="Town">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>TIN</label>
                                            <input type="text" class="form-control" formControlName="TIN">
                                        </div>
                                        <div class="field-group">
                                            <label>Telephone No.</label>
                                            <input type="text" class="form-control" formControlName="Telephone_No">
                                        </div>
                                        <div class="field-group">
                                            <label>Salary/Bonus (RM)</label>
                                            <textarea class="form-control" appThousandSeparator type="number"
                                                formControlName="Salary_Bonus"></textarea>
                                        </div>
                                        <div class="field-group">
                                            <label>Fees/Commission (RM)</label>
                                            <textarea class="form-control" appThousandSeparator type="number"
                                                formControlName="Fees_Commission_Allowances"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-outline-primary" (click)="addRow('c3')">+ Add
                            Officer</button>
                    </div>
                </fieldset>

                ---

                <fieldset id="attachment-c4">
                    <legend>Attachment C4: Major Shareholders</legend>
                    <div class="accordion-container" formArrayName="c4Rows">
                        <div *ngFor="let row of c4Rows.controls; let i = index" [formGroupName]="i"
                            class="accordion-item" [class.open]="accordionStates['c4'][i]">
                            <div class="accordion-header"
                                (click)="accordionStates['c4'][i] = !accordionStates['c4'][i]">
                                <h5 class="accordion-title">
                                    Shareholder {{ i + 1 }}: {{ row.get('Name_of_Shareholder_Partner')?.value || 'New
                                    Shareholder' }}
                                </h5>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button type="button" class="btn btn-sm btn-outline-danger"
                                        (click)="$event.stopPropagation(); removeRow('c4', i)">Remove</button>
                                    <span class="accordion-icon">{{ accordionStates['c4'][i] ? '−' : '+' }}</span>
                                </div>
                            </div>
                            <div *ngIf="accordionStates['c4'][i]" class="accordion-body">
                                <div class="details-grid">
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>Name of Shareholder/Partner</label>
                                            <input type="text" class="form-control"
                                                formControlName="Name_of_Shareholder_Partner">
                                        </div>
                                        <div class="field-group">
                                            <label>ID/Passport/Reg No.</label>
                                            <div class="input-group">
                                                <select formControlName="ID_type" class="form-select"
                                                    style="max-width: 100px;">
                                                    <option value="1">ID</option>
                                                    <option value="2">Passport</option>
                                                </select>
                                                <input type="text" class="form-control"
                                                    formControlName="ID_Passport_Reg_No" placeholder="Number">
                                            </div>
                                            <!-- <input type="text" class="form-control"
                                                formControlName="ID_Passport_Reg_No"> -->
                                        </div>
                                        <div class="field-group">
                                            <label>Date of Birth</label>
                                            <input type="date" class="form-control" formControlName="Date_of_Birth">
                                        </div>
                                        <div class="field-group">
                                            <label>Origin Country</label>
                                            <select class="form-select" formControlName="Country_of_Origin">
                                                <option value="" disabled>-- Select --</option>
                                                <option *ngFor="let country of countries" [value]="country.code">{{
                                                    country.name }}</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>Address</label>
                                            <div class="d-flex flex-column gap-2">
                                                <select class="form-select" formControlName="Country">
                                                    <option value="" disabled>-- Country --</option>
                                                    <option *ngFor="let country of countries" [value]="country.code">{{
                                                        country.name }}</option>
                                                </select>
                                                <textarea class="form-control" appAutoResize placeholder="Line 1"
                                                    formControlName="Address1"></textarea>
                                                <textarea class="form-control" appAutoResize placeholder="Line 2"
                                                    formControlName="Address2"></textarea>
                                                <input type="text" class="form-control" placeholder="Postcode"
                                                    formControlName="Postcode">
                                                <input type="text" class="form-control" placeholder="Town"
                                                    formControlName="Town">
                                            </div>
                                        </div>
                                        <div class="field-group">
                                            <label>TIN</label>
                                            <input type="text" class="form-control" formControlName="TIN">
                                        </div>
                                        <div class="field-group">
                                            <label>Shareholding (%)</label>
                                            <input type="number" class="form-control"
                                                formControlName="Direct_Shareholding_Percentage">
                                        </div>
                                        <div class="field-group">
                                            <label>Dividends (RM)</label>
                                            <textarea class="form-control" appThousandSeparator type="number"
                                                formControlName="Dividends_Received_in_Basis_Period"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-outline-primary" (click)="addRow('c4')">+ Add
                            Shareholder</button>
                    </div>
                </fieldset>


                <!-- Attachment C5: Beneficial Owners -->
                <fieldset id="attachment-c5">
                    <legend>Attachment C5: Beneficial Owners</legend>
                    <div class="accordion-container" formArrayName="c5Rows">
                        <div *ngFor="let row of c5Rows.controls; let i = index" [formGroupName]="i"
                            class="accordion-item" [class.open]="accordionStates['c5'][i]">
                            <div class="accordion-header"
                                (click)="accordionStates['c5'][i] = !accordionStates['c5'][i]">
                                <h5 class="accordion-title">
                                    Beneficial Owner {{ i + 1 }}: {{ row.get('Name')?.value || 'New Owner' }}
                                </h5>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button type="button" class="btn btn-sm btn-outline-danger"
                                        (click)="$event.stopPropagation(); removeRow('c5', i)">Remove</button>
                                    <span class="accordion-icon">{{ accordionStates['c5'][i] ? '−' : '+' }}</span>
                                </div>
                            </div>
                            <div *ngIf="accordionStates['c5'][i]" class="accordion-body">
                                <div class="details-grid">
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>Name</label>
                                            <input type="text" class="form-control" formControlName="Name">
                                        </div>
                                        <div class="field-group">
                                            <label>ID/Passport No.</label>
                                            <div class="input-group">
                                                <select formControlName="ID_type" class="form-select"
                                                    style="max-width: 100px;">
                                                    <option value="1">ID</option>
                                                    <option value="2">Passport</option>
                                                </select>
                                                <input type="text" class="form-control" formControlName="ID_Passport_No"
                                                    placeholder="Number">
                                            </div>
                                            <!-- <input type="text" class="form-control" formControlName="ID_Passport_No"> -->
                                        </div>
                                        <div class="field-group">
                                            <label>Date of Birth</label>
                                            <input type="date" class="form-control" formControlName="Date_of_Birth">
                                        </div>
                                        <div class="field-group">
                                            <label>Telephone No.</label>
                                            <input type="text" class="form-control" formControlName="Telephone_No">
                                        </div>
                                    </div>
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>Address</label>
                                            <div class="d-flex flex-column gap-2">
                                                <select class="form-select" formControlName="Country">
                                                    <option value="" disabled>-- Country --</option>
                                                    <option *ngFor="let country of countries" [value]="country.code">{{
                                                        country.name }}</option>
                                                </select>
                                                <textarea class="form-control" appAutoResize placeholder="Line 1"
                                                    formControlName="Address1"></textarea>
                                                <textarea class="form-control" appAutoResize placeholder="Line 2"
                                                    formControlName="Address2"></textarea>
                                                <input type="text" class="form-control" placeholder="Postcode"
                                                    formControlName="Postcode">
                                                <input type="text" class="form-control" placeholder="Town"
                                                    formControlName="Town">
                                            </div>
                                        </div>
                                        <div class="field-group">
                                            <label>TIN</label>
                                            <input type="text" class="form-control" formControlName="TIN">
                                        </div>
                                        <div class="field-group">
                                            <label>Shareholding (%)</label>
                                            <input type="number" class="form-control"
                                                formControlName="Shareholding_Percentage">
                                        </div>
                                    </div>
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>Salary/Bonus (RM)</label>
                                            <textarea class="form-control" appThousandSeparator type="number"
                                                formControlName="Salary_Bonus"></textarea>
                                        </div>
                                        <div class="field-group">
                                            <label>Fees/Commission (RM)</label>
                                            <textarea class="form-control" appThousandSeparator type="number"
                                                formControlName="Fees_Commission_Allowance"></textarea>
                                        </div>
                                        <div class="field-group">
                                            <label>Loan to Owner (RM)</label>
                                            <textarea class="form-control" appThousandSeparator type="number"
                                                formControlName="Total_Loan_to_Owner"></textarea>
                                        </div>
                                        <div class="field-group">
                                            <label>Loan from Owner (RM)</label>
                                            <textarea class="form-control" appThousandSeparator type="number"
                                                formControlName="Total_Loan_from_Owner"></textarea>
                                        </div>
                                        <div class="field-group">
                                            <label>Dividends (RM)</label>
                                            <textarea class="form-control" appThousandSeparator type="number"
                                                formControlName="Dividends_Received_in_Basis_Period"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-outline-primary" (click)="addRow('c5')">+ Add
                            Owner</button>
                    </div>
                </fieldset>

                <!-- Attachment C9: Financial Particulars -->
                <fieldset id="attachment-c9">
                    <legend>Attachment C9: Financial Particulars</legend>
                    <div class="form-column">
                        <h4>General Information</h4>
                        <!-- <label>Business Activity Code:</label>
                        <textarea appThousandSeparator formControlName="Business_Activity_Code"></textarea>
                        <label>Type of Business Activity:</label>
                        <textarea appThousandSeparator formControlName="Type_of_business_activity"></textarea> -->
                        <label for="Business_Activity_Code">Business Activity Code:</label>
                        <select id="Business_Activity_Code" formControlName="Business_Activity_Code" class="form-select"
                            style="margin-bottom: 10px;">
                            <option value="" disabled>-- Select a Code --</option>
                            <option *ngFor="let activity of businessActivities" [value]="activity.code">
                                {{ activity.code }}
                            </option>
                        </select>

                        <label for="Type_of_business_activity">Type of Business Activity:</label>
                        <textarea id="Type_of_business_activity" formControlName="Type_of_business_activity" readonly
                            style="background-color: #e9ecef; resize: none;"></textarea>
                        <label>Type of Labuan Entity:</label>
                        <textarea formControlName="Fp_Type_of_Labuan_entity" readonly
                            style="background-color: #e9ecef; resize: none;"></textarea>
                    </div>
                    <div class="form-grid">

                        <div class="form-column">
                            <h4>Profit & Loss</h4>

                            <label>Sales / Turnover:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Sales_Turnover"></textarea>
                            <label>Opening Inventory:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Opening_Inventory"></textarea>
                            <label>Cost of Purchases:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Cost_of_Purchases"></textarea>
                            <label>Cost of Production:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Cost_of_Production"></textarea>
                            <label>Closing Inventory:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Closing_Inventory"></textarea>
                            <label>Cost of Sales:</label>
                            <textarea readonly appThousandSeparator type="number"
                                formControlName="Pnl_Cost_of_Sales"></textarea>
                            <label>Gross Profit/Loss:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Gross_Profit_Loss"></textarea>
                            <label>Foreign Currency Exchange Gain:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Foreign_Currency_Exchange_Gain"></textarea>
                            <label>Other Business Income:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Other_Business_Income"></textarea>
                            <label>Other Income:</label>
                            <textarea appThousandSeparator type="number" formControlName="Pnl_Other_Income"></textarea>
                            <label>Non-Taxable Profits:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Non_Taxable_Profits"></textarea>
                            <label>Interest Expenditure:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Interest_Expenditure"></textarea>
                            <label>Professional Fees:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Professional_Fees"></textarea>
                            <label>Technical Fees to Non-Residents:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Technical_Fees_to_Non_Residents"></textarea>
                            <label>Contract Payments:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Contract_Payments"></textarea>
                            <label>Management Fee:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Management_Fee"></textarea>
                            <label>Salaries & Wages:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Salaries_Wages"></textarea>
                            <label>Cost of Employee Share Options:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Cost_of_Employee_Share_Options"></textarea>
                            <label>Royalties:</label>
                            <textarea appThousandSeparator type="number" formControlName="Pnl_Royalties"></textarea>
                            <label>Rental / Lease:</label>
                            <textarea appThousandSeparator type="number" formControlName="Pnl_Rental_Lease"></textarea>
                            <label>Maintenance & Repairs:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Maintenance_Repairs"></textarea>
                            <label>Research & Development:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Research_Development"></textarea>
                            <label>Promotion & Advertisement:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Promotion_Advertisement"></textarea>
                            <label>Travelling & Accommodation:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Travelling_Accommodation"></textarea>
                            <label>Foreign Currency Exchange Loss:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Foreign_Currency_Exchange_Loss"></textarea>
                            <label>Other Expenditure:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Other_Expenditure"></textarea>
                            <label>Total Expenditure:</label>
                            <textarea readonly appThousandSeparator type="number"
                                formControlName="Pnl_Total_Expenditure"></textarea>
                            <label>Net Profit/Loss:</label>
                            <textarea appThousandSeparator type="number"
                                formControlName="Pnl_Net_Profit_Loss"></textarea>
                            <div class="calculated-field-wrapper">

                            </div>
                        </div>
                        <div>
                            <div class="form-column">
                                <h4>Assets</h4>
                                <label>Motor Vehicles:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Motor_Vehicles"></textarea>
                                <label>Plant & Equipment:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Plant_Equipment"></textarea>
                                <label>Land & Buildings:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Land_Buildings"></textarea>
                                <label>Other Non-Current Assets:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Other_Non_Current_Assets"></textarea>
                                <label>Investments:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Investments"></textarea>
                                <label>Total Non-Current Assets:</label>
                                <textarea readonly appThousandSeparator type="number"
                                    formControlName="Fp_Total_Non_Current_Assets"></textarea>
                                <label>Cost of NCA Acquired:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Cost_of_NCA_Acquired"></textarea>
                                <label>Trade Debtors:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Trade_Debtors"></textarea>
                                <label>Other Debtors:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Other_Debtors"></textarea>
                                <label>Inventory:</label>
                                <textarea appThousandSeparator type="number" formControlName="Fp_Inventory"></textarea>
                                <label>Loans to Related Entities:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Loans_to_Related_Entities"></textarea>
                                <label>Cash in Hand & Bank:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Cash_in_Hand_Bank"></textarea>
                                <label>Other Current Assets:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Other_Current_Assets"></textarea>
                                <label>Total Current Assets:</label>
                                <textarea readonly appThousandSeparator type="number"
                                    formControlName="Fp_Total_Current_Assets"></textarea>
                                <label>Total Assets:</label>
                                <textarea readonly appThousandSeparator type="number"
                                    formControlName="Fp_Total_Assets"></textarea>
                            </div>
                            <div class="form-column">
                                <h4>Liabilities & Equity</h4>
                                <label>Loans & Bank Overdrafts:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Loans_Bank_Overdrafts"></textarea>
                                <label>Trade Creditors:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Trade_Creditors"></textarea>
                                <label>Other Creditors:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Other_Creditors"></textarea>
                                <label>Loans from Related Entities:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Loans_from_Related_Entities"></textarea>
                                <label>Other Current Liabilities:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Other_Current_Liabilities"></textarea>
                                <label>Total Current Liabilities:</label>
                                <textarea appThousandSeparator type="number" readonly
                                    formControlName="Fp_Total_Current_Liabilities"></textarea>
                                <label>Non-Current Liabilities:</label>
                                <textarea readonly appThousandSeparator type="number"
                                    formControlName="Fp_Non_Current_Liabilities"></textarea>
                                <label>Total Liabilities:</label>
                                <textarea readonly appThousandSeparator type="number"
                                    formControlName="Fp_Total_Liabilities"></textarea>
                                <label>Issued & Paid-Up Capital:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Issued_Paid_Up_Capital"></textarea>
                                <label>Profit & Loss Appropriation:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Profit_Loss_Appropriation"></textarea>
                                <label>Reserve Account:</label>
                                <textarea appThousandSeparator type="number"
                                    formControlName="Fp_Reserve_Account"></textarea>
                                <label>Total Equity:</label>
                                <textarea readonly appThousandSeparator type="number"
                                    formControlName="Fp_Total_Equity"></textarea>
                                <label>Total Liabilities & Equity:</label>
                                <textarea appThousandSeparator type="number" readonly
                                    formControlName="Fp_Total_Liabilities_and_Equity"></textarea>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <!-- Attachment C10: Subsidiaries or Related Entities -->
                <fieldset id="attachment-c10" *ngIf="le1Form.get('C10_Has_Subsidiary_Outside_Labuan')?.value === '1'">
                    <legend>Attachment C10: Subsidiaries or Related Entities</legend>
                    <div class="accordion-container" formArrayName="c10Rows">
                        <div *ngFor="let row of c10Rows.controls; let i = index" [formGroupName]="i"
                            class="accordion-item" [class.open]="accordionStates['c10'][i]">
                            <div class="accordion-header"
                                (click)="accordionStates['c10'][i] = !accordionStates['c10'][i]">
                                <h5 class="accordion-title">
                                    Subsidiary {{ i + 1 }}: {{ row.get('Name')?.value || 'New Subsidiary' }}
                                </h5>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button type="button" class="btn btn-sm btn-outline-danger"
                                        (click)="$event.stopPropagation(); removeRow('c10', i)">Remove</button>
                                    <span class="accordion-icon">{{ accordionStates['c10'][i] ? '−' : '+' }}</span>
                                </div>
                            </div>
                            <div *ngIf="accordionStates['c10'][i]" class="accordion-body">
                                <div class="details-grid">
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>Name</label>
                                            <input type="text" class="form-control" formControlName="Name">
                                        </div>
                                        <div class="field-group">
                                            <label>Registration No.</label>
                                            <input type="text" class="form-control" formControlName="Registration_No">
                                        </div>
                                    </div>
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>TIN</label>
                                            <input type="text" class="form-control" formControlName="TIN">
                                        </div>
                                        <div class="field-group">
                                            <label>Transactions (1=Y, 2=N)</label>
                                            <select formControlName="Have_Transactions" class="form-select">
                                                <option value="" disabled>-- Select --</option>
                                                <option value="1">Yes</option>
                                                <option value="2">No</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-outline-primary" (click)="addRow('c10')">+ Add
                            Subsidiary</button>
                    </div>
                </fieldset>

                <!-- Attachment C11: Payments Received from Malaysian Residents -->
                <fieldset id="attachment-c11"
                    *ngIf="le1Form.get('C11_Received_Payments_from_Malaysian_Resident')?.value === '1'">
                    <legend>Attachment C11: Payments Received from Malaysian Residents</legend>
                    <div class="accordion-container" formArrayName="c11Rows">
                        <div *ngFor="let row of c11Rows.controls; let i = index" [formGroupName]="i"
                            class="accordion-item" [class.open]="accordionStates['c11'][i]">
                            <div class="accordion-header"
                                (click)="accordionStates['c11'][i] = !accordionStates['c11'][i]">
                                <h5 class="accordion-title">
                                    Payer {{ i + 1 }}: {{ row.get('Name_of_taxpayer')?.value || 'New Payer' }}
                                </h5>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button type="button" class="btn btn-sm btn-outline-danger"
                                        (click)="$event.stopPropagation(); removeRow('c11', i)">Remove</button>
                                    <span class="accordion-icon">{{ accordionStates['c11'][i] ? '−' : '+' }}</span>
                                </div>
                            </div>
                            <div *ngIf="accordionStates['c11'][i]" class="accordion-body">
                                <div class="details-grid">
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>Payer Name</label>
                                            <input type="text" class="form-control" formControlName="Name_of_taxpayer">
                                        </div>
                                        <div class="field-group">
                                            <label>Payer TIN</label>
                                            <input type="text" class="form-control" formControlName="TIN">
                                        </div>
                                    </div>
                                    <div class="details-column">
                                        <div class="field-group">
                                            <label>Payment Type</label>
                                            <select formControlName="Type_of_payment_received" class="form-select">
                                                <option value="" disabled>-- Select --</option>
                                                <option value="1">Interest Payment</option>
                                                <option value="2">Lease Rental</option>
                                                <option value="3">Other Payment</option>
                                            </select>
                                        </div>
                                        <div class="field-group">
                                            <label>Payment To Related Entity</label>
                                            <select formControlName="Payment_Related_to" class="form-select">
                                                <option value="" disabled>-- Select --</option>
                                                <option value="1">Yes</option>
                                                <option value="2">No</option>
                                            </select>
                                        </div>
                                        <div class="field-group">
                                            <label>Amount (RM)</label>
                                            <textarea class="form-control" appThousandSeparator type="number"
                                                formControlName="Amount"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-outline-primary" (click)="addRow('c11')">+ Add
                            Payer</button>
                    </div>
                </fieldset>


            </form>
        </div>
        <!-- Add this at the bottom of your main .content div -->
        <div class="sticky-footer">
            <!-- Saved -->
            <div class="status-text" *ngIf="!le1Form.dirty">
                <span class="badge bg-info text-dark">Saved</span>
            </div>
            <div class="status-text" *ngIf="le1Form.dirty">
                <span class="badge bg-warning text-dark">Unsaved Changes</span>
            </div>
            <!-- <div class="action-buttons">
                <button type="button" class="btn btn-outline-secondary me-2" (click)="saveProject()">Save Draft</button>
                <button type="button" class="btn btn-primary" (click)="submit()">Submit & Export</button>
            </div> -->
            <div style="display: flex; gap: 10px; align-items: center;">
                <button (click)="saveProject()" [disabled]="isLoading">Save</button>
                <!-- <button type="submit" (click)="generatePdf()">Generate PDF</button> -->
                <button type="submit" (click)="submit()">Submit</button>

            </div>
        </div>
    </div>
</div>

<div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
    <h2>Loading Project Data...</h2>
    <p>Please wait a moment.</p>
</div>

<ng-container *ngIf="isInstructionModalVisible">
    <div class="modal-overlay" (click)="closeInstructionModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h2>Automation Instructions</h2>
            <button class="close-button" (click)="closeInstructionModal()">&times;</button>
        </div>
        <div class="modal-body">

            <p>Your form data is validated and ready. Follow the steps below to automatically fill the LHDN portal.</p>

            <hr>

            <h4>Step 1: Copy Your Form Data</h4>
            <p>Click the button below to copy your form data. You will paste this into the extension in a later step.
            </p>
            <div class="json-container">
                <textarea readonly>{{ jsonDataForExtension }}</textarea>
                <button (click)="copyJsonToClipboard()">{{ copyButtonText }}</button>
            </div>

            <hr>

            <h4>Step 2: Prepare the Automation Tool (One-Time Setup)</h4>
            <ol>
                <li>
                    <strong>Download the extension:</strong>
                    <!-- 
            ACTION REQUIRED: You need to zip your extension folder (containing manifest.json, popup.js, etc.)
            and host it. A simple way is to place it in your Angular project's 'src/assets' folder.
          -->
                    <a href="assets/lhdn-extension.zip" download="lhdn-extension.zip">
                        Click here to download the LHDN Filler Extension (.zip)
                    </a>
                </li>
                <li><strong>Unzip the file</strong> on your computer. You will have a folder named `lhdn-extension`.
                </li>
                <li>
                    <strong>Open your browser's extensions page:</strong>
                    <ul>
                        <li>For Chrome, go to: <code>chrome://extensions</code></li>
                        <li>For Edge, go to: <code>edge://extensions</code></li>
                    </ul>
                </li>
                <li>
                    <strong>Enable "Developer mode"</strong>. This is usually a toggle switch in the top-right corner of
                    the
                    extensions page.
                </li>
                <li>
                    Click the <strong>"Load unpacked"</strong> button and select the `lhdn-extension` folder you
                    unzipped.
                    The extension icon (🚀) will now appear in your browser toolbar.
                </li>
            </ol>

            <hr>

            <h4>Step 3: Run the Automation</h4>
            <ol>
                <li>
                    <strong>Log in to the LHDN portal:</strong>
                    <a href="https://mytax.hasil.gov.my/" target="_blank" rel="noopener noreferrer">
                        Open MyTax Portal in a new tab
                    </a>
                </li>
                <li>Navigate manually through the portal until you are on the <strong>very first page</strong> of the
                    LE1 form
                    (the "Maklumat Asas" / "Basic Information" page).</li>
                <li>Click the LHDN Filler Extension icon (🚀) in your toolbar. A popup will appear.</li>
                <li><strong>Paste your copied data</strong> into the text box.</li>
                <li>Click the <strong>"Start Full Automation"</strong> button and the extension will fill and navigate
                    through
                    the pages for you.</li>
            </ol>

        </div>
    </div>
</ng-container>