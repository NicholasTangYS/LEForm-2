
<div class="container" id="upload-container" *ngIf="!isLoading">
    <div style="display: flex;">
        <button (click)="cancel()" style="padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    border: 1px;
    background: #d9d9d9;">Cancel</button>
    </div>
    
    <h1>LE1 Form Document Upload</h1>
    <h3>Upload Your Documents</h3>
    <p>Please upload the relevant files. The system will extract the data and pre-fill the form for you.</p>

    <!-- <div class="upload-area" [class.file-selected]="taxFileName" (click)="taxFileInp.click()">
        <div *ngIf="!taxFileName; else taxFileSelected">
            <label>Tax Computation Summary (Part A & B)</label>
        </div>
        <ng-template #taxFileSelected>
            <span class="file-name">{{ taxFileName }}</span>
            <button class="remove-btn" (click)="removeFile('tax'); $event.stopPropagation()">&times;</button>
        </ng-template>
        <input type="file" accept="image/*, .pdf" #taxFileInp (change)="onFileSelected($event, 'tax')" hidden>
    </div>

    <div class="upload-area" [class.file-selected]="shareholderFileName" (click)="shareholderFileInp.click()">
        <div *ngIf="!shareholderFileName; else shareholderFileSelected">
            <label>Shareholder & Officer Details (Attachments C3, C4, C5)</label>
        </div>
        <ng-template #shareholderFileSelected>
            <span class="file-name">{{ shareholderFileName }}</span>
            <button class="remove-btn" (click)="removeFile('shareholder'); $event.stopPropagation()">&times;</button>
        </ng-template>
        <input type="file" accept="image/*, .pdf" #shareholderFileInp (change)="onFileSelected($event, 'shareholder')" hidden>
    </div> -->

    <div class="upload-area" [class.file-selected]="financialsFileName" (click)="financialsFileInp.click()">
        <div *ngIf="!financialsFileName; else financialsFileSelected">
            <label>Financial Statements (Part A)</label>
        </div>
        <ng-template #financialsFileSelected>
            <span class="file-name">{{ financialsFileName }}</span>
            <button class="remove-btn" (click)="removeFile('financials'); $event.stopPropagation()">&times;</button>
        </ng-template>
        <input type="file" accept="image/*, .pdf" #financialsFileInp (change)="onFileSelected($event, 'financials')" hidden>
    </div>

    <div class="upload-area" [class.file-selected]="shareholderFileName" (click)="shareholderFileInp.click()">
        <div *ngIf="!shareholderFileName; else shareholderFileSelected">
            <label>Annual Return (Attachments C3, C4)</label>
        </div>
        <ng-template #shareholderFileSelected>
            <span class="file-name">{{ shareholderFileName }}</span>
            <button class="remove-btn" (click)="removeFile('shareholder'); $event.stopPropagation()">&times;</button>
        </ng-template>
        <input type="file" accept="image/*, .pdf" #shareholderFileInp (change)="onFileSelected($event, 'shareholder')" hidden>
    </div>

    <div class="upload-area" [class.file-selected]="c5FileName" (click)="c5FileInp.click()">
        <div *ngIf="!c5FileName; else c5FileSelected">
            <label>Annexure (Attachments C5)</label>
        </div>
        <ng-template #c5FileSelected>
            <span class="file-name">{{ c5FileName }}</span>
            <button class="remove-btn" (click)="removeFile('c5'); $event.stopPropagation()">&times;</button>
        </ng-template>
        <input type="file" accept="image/*, .pdf" #c5FileInp (change)="onFileSelected($event, 'c5')" hidden>
    </div>

     <div class="upload-area" [class.file-selected]="SRFileName" (click)="SRFileInp.click()">
        <div *ngIf="!SRFileName; else SRFileSelected">
            <label>SR Confirmation</label>
        </div>
        <ng-template #SRFileSelected>
            <span class="file-name">{{ SRFileName }}</span>
            <button class="remove-btn" (click)="removeFile('sr'); $event.stopPropagation()">&times;</button>
        </ng-template>
        <input type="file" accept="image/*, .pdf" #SRFileInp (change)="onFileSelected($event, 'sr')" hidden>
    </div>
     <div class="upload-area" [class.file-selected]="LEFileName" (click)="LEFileInp.click()">
        <div *ngIf="!LEFileName; else LEFileSelected">
            <label>Last Year LE</label>
        </div>
        <ng-template #LEFileSelected>
            <span class="file-name">{{ LEFileName }}</span>
            <button class="remove-btn" (click)="removeFile('le'); $event.stopPropagation()">&times;</button>
        </ng-template>
        <input type="file" accept="image/*, .pdf" #LEFileInp (change)="onFileSelected($event, 'le')" hidden>
    </div>

    <button class="btn" (click)="processFiles()">Process Documents</button>
</div>

<div id="loader" *ngIf="isLoading">
    <div class="spinner"></div>
    <h2>Processing documents...</h2>
    <p>This may take a moment. Please wait.</p>
</div>

<div class="modal-overlay" *ngIf="showFailureModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Processing Issues Detected</h2>
      <p>The following documents could not be processed. You can retry them or proceed with only the successful files.</p>
    </div>
    <div class="modal-body">
      <ul class="failed-list">
        <li *ngFor="let failed of failedRequests">
          <strong>{{ failed.name }}</strong>
          <span class="error-reason">{{ failed.reason }}</span>
        </li>
      </ul>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="retryFailedRequests()">Retry Failed</button>
      <button class="btn" (click)="proceedIgnoringFailures()">Proceed Anyway</button>
    </div>
  </div>
</div>